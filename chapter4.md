# 4강 계약설계

### 사전 조건, 사후 조건, 불변식

이번 장에서는 계약 설계에 대한 내용을 다뤘음. 계약이라고 해서 어려운 내용은 아니고 사전 조건, 사후 조건, 불변식 preCondition, postCondition, Invariant에 관한 내용임.

우리가 어떤 method를 정의한다고 할때 이 메소드의 입력으로 들어오는 값들은 어떤 조건을 만족해야하고, 그러한 조건을 잘 만족한다면 어떠어떠한 조건을 만족하는 결과를 돌려준다는 보장을 할 수 있음. 이때 입력에 대한 조건이 사전 조건, 결과값에 대한 조건이 사후 조건이 되는거임.

예를 들어서 은행 계좌에 입출금하는 메쏘드를 만든다고 하면, 은행 계좌랑 넣을 금액이 필요할 거임.
사전 조건은 은행계좌는 은행에 존재하는 계좌여야 한다. 넣을 금액은 음수여서는 안된다 등이 있을 수 있음.
사후 조건은 넣고 난다음에 은행 잔액이 이전보다 늘어나야 한다. 0이상이어야한다 뭐 이런 조건이 있을 수 있음.

불변식은 뭐냐? 사전과 사후에 모두 만족해야하는 조건을 의미함. 메소드 들어갈때 만족하고, 메소드 나올때 모두 만족해야하는 성질을 말함. 예를 들어 인출을 하든 입금을 하든 특정 계좌의 잔액은 첨에 메소드 실행할때도 0이상이어야 하고 실행하고 나올때도 0이상이어야한다 이런게 될 수 있음.

이제 이런 사전 조건, 사후조건, 불변식을 체크하기 위해서 assert를 활용할 수도 있고, if절로 걸어서 exception을 걸 수도 있음. 뭐가더 좋다라고 명시적으로 정해진 것은 없고, 상황에 맞게 사용해야함.

한가지 주의해야할 사항은 자바의 경우 런타임에 assert를 꺼놓을 수 있기때문에 런타이에서도 돌아가게 하려면 JVM 설정을 바꿔줘야함.

### 강한 조건, 약한 조건

강한 조건은 만족안하면 그냥 예외로 잡아버리는거고 약한 조건은 만족 안하더라도 이에 대한 처리를 해서 그냥 값을 내어보내주는거임. 예를 들어 음수가 들어오면 그냥 예외 던져버리는 방법이 강한 조건, 음수 들어오면 -1 같은 의미없는 값을 내보내주는게 약한 조건임. 뭐가 더 좋고 나쁘다는 없고 역시 상황에 맞게 사용하자

### 계약 변경과 리스코프 치환 법칙

계약의 조건을 좀 더 강화하거나 약화할 수 있음. 일단 최대한 조건은 안바꾸는게 좋은데 상황에 따라 필요할 수가 있음. 이럴때는 바꾸려는 대상이 아니라 바꾸려는 대상을 이용하는 대상들에서 문제가 발생하지 않을지 봐야함. 일반화해서 말하자면 사전조건을 바꾸려면 약화시키는건 괜찮아도 더 강화시키는건 안됨. 왜냐면 호출하는 쪽에서는 모르거든. 사후조건은 더 강화시키는건 돼도 약화시키는건 안됨. 마찬가지로 호출하는 쪽에서 모름

### 입력 유효성 검사

그리고 입력 유효성 검사가 있는데 이게 계약과 비슷한듯 하지만 좀 달라.

예를 들어서 어떤 함수 f(x)를 만들었는데 x가 정수여야한다고 하자. 그럼 입력 유효성 검사는 x에 정수가 아닌 타입이 들어오면 잘 못 들어왔따고 말해주는거임. 반면에 사전 조건은 100이상인 정수만 들어와야함. 100 이상인 정수가 들어와야 사후조건을 보장해줄 수 있음 뭐 이런 거임. 그래서 두개가 다르다는걸 알고 둘다 체크해줘야함.

### 계약 사항에 대한 테스트를 작성해야할까?

지금까지 살펴본 내용을 보면 사전조건, 사후조건, 불변식에 대해서 다 예외 처리같은걸 해주었음. 이 경우와 관련해서도 테스트를 작성해야할까? 상황에 따라 다르겠지만, 책의 저자는 보통 입력 유효성 검사는 테스트를 작성해서 잘 걸러내는지 확인하고, 계약 사항에 대한 내용은 비지니스 로직을 다루는 다른 테스트에서 자연스럽게 일어나게 둔다고 함
